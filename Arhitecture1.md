# SPEC-1 ‚Äî –ü–æ–∏—Å–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–≤ –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º (–±–æ—Ç –≤ Telegram)

## Background

–õ—é–¥—è–º —á–∞—Å—Ç–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ¬´—Å–≤–æ–∏—Ö¬ª —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–≤ –ø–æ –Ω–∏—à–µ–≤—ã–º –∏–Ω—Ç–µ—Ä–µ—Å–∞–º (—Ö–æ–±–±–∏, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ–º—ã, –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏). –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ—Ü—Å–µ—Ç–∏ –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç —à–∏—Ä–æ–∫–∏–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞, –Ω–æ —Å–ª–∞–±—É—é –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—é, –∞ —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Ç—ã –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω—ã —à—É–º–æ–º.

–ò–¥–µ—è: —Å–æ–∑–¥–∞—Ç—å –ª—ë–≥–∫–∏–π –≤—Ö–æ–¥ –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –¥–∏–∞–ª–æ–≥ ¬´–æ–¥–∏–Ω –Ω–∞ –æ–¥–∏–Ω¬ª –∏–ª–∏ –≤ –º–∞–ª—É—é –≥—Ä—É–ø–ø—É (2‚Äì4 —á–µ–ª–æ–≤–µ–∫–∞) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –∏ –æ–∂–∏–¥–∞–Ω–∏–π: —Ñ–æ—Ä–º–∞—Ç –æ–±—â–µ–Ω–∏—è (—á–∞—Ç/–∞—É–¥–∏–æ), —Ü–µ–ª—å (–ø–æ–¥–¥–µ—Ä–∂–∫–∞, –æ–±–º–µ–Ω –æ–ø—ã—Ç–æ–º, –¥—Ä—É–∂–±–∞), —è–∑—ã–∫, —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å. MVP —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω –Ω–∞ Telegram-–±–æ—Ç–µ, —Ç.–∫. —É –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ –≤—Ö–æ–¥–∞, —Ö–æ—Ä–æ—à–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –¥–ª—è —á–∞–µ–≤—ã—Ö.



## Requirements

**Vision:** ¬´–¢—ã –Ω–µ –æ–¥–∏–Ω¬ª ‚Äî —Å–µ—Ä–≤–∏—Å 1‚Äë–Ω–∞‚Äë1 –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—â–∏—Ö –ø–µ—Ä–µ–∂–∏—Ç—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π –∏ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤. –°—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ ‚Äî Telegram‚Äë–±–æ—Ç.

### MoSCoW
**Must**
- RU/CIS —Ä—ã–Ω–æ–∫, —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ‚Äî —Ä—É—Å—Å–∫–∏–π.
- Telegram‚Äë–±–æ—Ç –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –≤ MVP.
- –ú–∞—Ç—á–∏–Ω–≥ —Ç–æ–ª—å–∫–æ 1‚Äë–Ω–∞‚Äë1.
- –ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ø—Å–µ–≤–¥–æ–Ω–∏–º + –Ω–∞–±–æ—Ä —Ç–µ–º + —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å + –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–±–µ–∑ –§–ò–û/—Ç–µ–ª–µ—Ñ–æ–Ω–∞/–ø–æ—á—Ç—ã/–≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏).
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram.
- –ü—Ä–æ—Ñ–∏–ª—å —Å —Ç–µ–≥–∞–º–∏/—Ç–µ–º–∞–º–∏ –ø–µ—Ä–µ–∂–∏—Ç–æ–≥–æ –æ–ø—ã—Ç–∞ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ (–Ω–∞–ø—Ä. ¬´–ø–µ—Ä–µ–µ–∑–¥¬ª, ¬´–≤—ã–≥–æ—Ä–∞–Ω–∏–µ¬ª, ¬´—Ä–∞–∑–≤–æ–¥¬ª –∏ —Ç.–ø.).
- –Ø–≤–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã —Å–µ—Ä–≤–∏—Å–∞: peer‚Äëto‚Äëpeer –ø–æ–¥–¥–µ—Ä–∂–∫–∞, –Ω–µ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–∏—è; –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≥–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏.
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –∂–∞–ª–æ–±–∞/–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –∞–≤—Ç–æ—Ä–∞–∑—Ä—ã–≤ –º–∞—Ç—á–∞.
- –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å: –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–∞–≤–æ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è/–¥–∏–∞–ª–æ–≥–æ–≤.
- –ë–∞–∑–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –º–∞—Ç—á–µ–π: –≤–∑–∞–∏–º–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ 2‚Äì3 –∫–ª—é—á–µ–≤—ã–º —Ç–µ–≥–∞–º + —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å/–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞.
- –ß–∞–µ–≤—ã–µ –ø–æ—Å–ª–µ –¥–∏–∞–ª–æ–≥–∞; –º–æ–¥–µ–ª—å –∫–æ–º–∏—Å—Å–∏–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

**Should**
- –ê–Ω–∫–µ—Ç–∞ –æ–∂–∏–¥–∞–Ω–∏–π: —Ü–µ–ª—å (–ø–æ–¥–¥–µ—Ä–∂–∫–∞/—Å–æ–≤–µ—Ç/–¥—Ä—É–∂–±–∞), —Ñ–æ—Ä–º–∞—Ç (—á–∞—Ç), —É—Ä–æ–≤–µ–Ω—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–º.
- –û–Ω–±–æ—Ä–¥–∏–Ω–≥ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –∏ –ø—Ä–∞–≤–∏–ª.
- –†–µ–π—Ç–∏–Ω–≥ ¬´–ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏¬ª –¥–∏–∞–ª–æ–≥–∞ (—ç–º–æ–¥–∑–∏/1‚Äì5), –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—ã–¥–∞—á—É.
- –¢–µ—Å—Ç A/B: —Å—Ç—Ä–æ–≥–∏–π –º–∞—Ç—á –ø–æ —Ç–µ–≥–∞–º vs –º—è–≥–∫–∏–π (—Å—É–ø–µ—Ä—Å–µ—Ç —Ç–µ–º).

**Could**
- –¢–µ–º–ø‚Äë—á–∞—Ç (—Ç–∞–π–º–µ—Ä 24‚Äì72 —á) —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é ¬´–ø—Ä–æ–¥–ª–∏—Ç—å¬ª –ø–æ –≤–∑–∞–∏–º–Ω–æ–º—É —Å–æ–≥–ª–∞—Å–∏—é.
- –ê–Ω–æ–Ω–∏–º–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä–∫–∏/—Å—Ç–∏–∫–µ—Ä—ã –æ—Ç –±–æ—Ç–∞.
- ¬´–ö–æ‚Äë–ª–∏—Å—Ç¬ª ‚Äî —Å–ø–∏—Å–æ–∫ —Ç–µ–º –Ω–∞ –±—É–¥—É—â–µ–µ.
- –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –¥–∞–π–¥–∂–µ—Å—Ç—ã: ¬´–≤–∞–º –ø–æ–¥—Ö–æ–¥—è—Ç 5 –Ω–æ–≤—ã—Ö –ª—é–¥–µ–π¬ª.

**Won‚Äôt (MVP)**
- –ì—Ä—É–ø–ø—ã/–∞—É–¥–∏–æ/–≤–∏–¥–µ–æ.
- –ü—É–±–ª–∏—á–Ω—ã–µ —á–∞—Ç—ã –∏ –ª–µ–Ω—Ç—ã.
- –ü—Ä–æ—Ñ‚Äë–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∏ –º–µ–¥‚Äë—Å–æ–≤–µ—Ç—ã.



## Method

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (MVP)
- –ö–ª–∏–µ–Ω—Ç: Telegram‚Äë–±–æ—Ç (Bot API).
- –ë—ç–∫–µ–Ω–¥: HTTP API (Node.js/TypeScript –∏–ª–∏ Python) + –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á.
- –•—Ä–∞–Ω–∏–ª–∏—â–µ: PostgreSQL (–ø—Ä–æ—Ñ–∏–ª–∏, —Ç–µ–≥–∏, –º–∞—Ç—á–∏, –º–µ—Ç—Ä–∏–∫–∏), Redis (–∫—ç—à–∏ –∏ –æ—á–µ—Ä–µ–¥—å –º–∞—Ç—á–µ–π), S3‚Äë—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–æ–≤.
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: Telegram Bot API (—á–∞—Ç—ã, inline‚Äë–∫–Ω–æ–ø–∫–∏), –ø–ª–∞—Ç–µ–∂–∏ (PSP/Stars), –∞–Ω—Ç–∏‚Äë—Å–ø–∞–º/—Ä–µ–π—Ç‚Äë–ª–∏–º–∏—Ç—ã.
- **AI‚Äë–º–æ–¥—É–ª—å (coach‚Äë–≤‚Äë–¥–∏–∞–ª–æ–≥–µ, –Ω–µ —Ç–µ—Ä–∞–ø–µ–≤—Ç):** —Å–µ—Ä–≤–∏—Å –ø–æ–¥—Å–∫–∞–∑–æ–∫ –ø–æ —ç–º–ø–∞—Ç–∏—á–Ω–æ–º—É –æ–±—â–µ–Ω–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–∞—Ç–∞; –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–Ω–µ –≤–º–µ—à–∏–≤–∞–µ—Ç—Å—è, —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏).

```plantuml
@startuml
actor UserA as A
actor UserB as B
participant "Telegram Bot" as Bot
participant API
collections Redis
database Postgres as DB
rectangle Payments {
  [PSP]
}
rectangle AI {
  [Prompt Orchestrator]
  [LLM Provider]
  [Safety Filters]
}

A -> Bot: —Å–æ–æ–±—â–µ–Ω–∏—è
B -> Bot: —Å–æ–æ–±—â–µ–Ω–∏—è
Bot -> API: webhook updates
API -> Redis: store context window
API -> AI: request coaching hints (anonymized)
AI -> API: hints (empathetic phrasing, questions)
API -> Bot: send inline hints (–≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å)
API -> DB: store feedback & metrics
...
A -> Bot: ¬´–û—Å—Ç–∞–≤–∏—Ç—å —á–∞–µ–≤—ã–µ¬ª
Bot -> Payments: invoice
@enduml
```

### –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (—á–µ—Ä–Ω–æ–≤–∏–∫)
- `users(id, tg_id, nickname, tz, bio_short, safety_ack, created_at)`
- `topics(id, slug, title)`
- `user_topics(user_id, topic_id, weight)`
- `preferences(user_id, sensitivity_level, purpose, avail_windows)`
- `match_queue(user_id, score_ready_at)`
- `matches(id, user_a, user_b, created_at, status)`
- `chat_sessions(id, match_id, started_at, ended_at, rating_a, rating_b)`
- `tips(id, match_id, from_user, to_user, amount_minor, currency, provider, provider_fee_minor, our_commission_minor, status, created_at)`
- **AI‚Äë—Å—É—â–Ω–æ—Å—Ç–∏:**
  - `ai_hints(id, chat_session_id, user_id, hint_type, text, created_at, accepted boolean)`
  - `safety_flags(id, chat_session_id, user_id, label, severity, created_at)`
- –ò–Ω–¥–µ–∫—Å—ã –ø–æ `user_topics(topic_id)`, GIN –ø–æ –º–∞—Å—Å–∏–≤–∞–º —Ç–µ–º/–æ–∫–æ–Ω, `matches(user_a,user_b)` —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å.

### –ê–ª–≥–æ—Ä–∏—Ç–º –º–∞—Ç—á–∏–Ω–≥–∞ (MVP)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç ¬´–ù–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞¬ª. –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –æ—á–µ—Ä–µ–¥—å —Å TTL (–Ω–∞–ø—Ä–∏–º–µ—Ä, 24 —á).
2. –í—ã–±–∏—Ä–∞–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤:
   - –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ ‚â•2 –æ–±—â–∏–º —Ç–µ–º–∞–º (–≤–µ—Å–∞–º ‚â• –ø–æ—Ä–æ–≥–∞).
   - –°–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –æ–∫–Ω–∞ –ø–æ —á–∞—Å–æ–≤–æ–º—É –ø–æ—è—Å—É/–≤—Ä–µ–º–µ–Ω–∏.
   - –ò—Å–∫–ª—é—á–∞–µ–º –Ω–µ–¥–∞–≤–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –º–∞—Ç—á–∏.
3. –°—á–∏—Ç–∞–µ–º —Å–∫–æ—Ä–∏–Ω–≥: `score = 0.6*tags_overlap + 0.2*time_overlap + 0.2*recent_helpfulness`.
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª—É—á—à–µ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –æ–±–æ–∏–º —Å –ø—Ä–µ–≤—å—é: –ø—Å–µ–≤–¥–æ–Ω–∏–º, 3 —Ç–æ–ø‚Äë—Ç–µ–≥–∞, –∫–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ. –¢—Ä–µ–±—É–µ–º **–≤–∑–∞–∏–º–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è**.
5. –ü—Ä–∏ —Å–æ–≥–ª–∞—Å–∏–∏ —Å–æ–∑–¥–∞—ë–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç (–±–æ—Ç —à–ª—ë—Ç –∏–Ω—Ç—Ä–æ‚Äë—Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø—Ä–∞–≤–∏–ª–∞).

### –ü–ª–∞—Ç–µ–∂–∏ –∏ –∫–æ–º–∏—Å—Å–∏—è (—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è RU/CIS)
- –ß–∞–µ–≤—ã–µ –∫–∞–∫ —Ü–∏—Ñ—Ä–æ–≤–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç: Telegram Stars –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π PSP (YooKassa/CloudPayments/ECOMMPAY).
- Stripe ‚Äî –¥–ª—è –±—É–¥—É—â–µ–≥–æ EN‚Äë–∑–∞–ø—É—Å–∫–∞.
- –£—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–∏: –Ω–∞ —É—Ä–æ–≤–Ω–µ –∑–∞–ø–∏—Å–∏ `tips` —Ñ–∏–∫—Å–∏—Ä—É–µ–º fee –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∏ –Ω–∞—à—É –∫–æ–º–∏—Å—Å–∏—é; –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —á–µ–∫ –≤ —á–∞—Ç–µ.

### AI‚Äëcoach: —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
  - –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —ç–º–ø–∞—Ç–∏—á–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –∏ –≤–æ–ø—Ä–æ—Å—ã (–Ω–∞–ø—Ä. ¬´–≥–æ–≤–æ—Ä–∏—Ç—å –ø—Ä–æ –ø–æ—Ç–µ—Ä—é –ø–∏—Ç–æ–º—Ü–∞¬ª), –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –ø—Ä–æ –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–ª—É—à–∞–Ω–∏–µ, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —á—É–≤—Å—Ç–≤–∞.
  - –ü–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã: –Ω–µ –¥–∞–≤–∞—Ç—å –º–µ–¥/—é—Ä–∏–¥. —Å–æ–≤–µ—Ç–æ–≤, –Ω–µ –æ–±–µ—â–∞—Ç—å ¬´–≤—Å—ë –∏—Å–ø—Ä–∞–≤–∏—Ç—å¬ª.
  - –í—ã—è–≤–ª—è–µ—Ç —Ä–∏—Å–∫–∏ (—Å–∞–º–æ–ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ/–∫—Ä–∏–∑–∏—Å) ‚Äî *—Ç–æ–ª—å–∫–æ —Ñ–ª–∞–≥–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏* –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≥–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏; –Ω–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä—É–µ—Ç.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  - –ö–æ–Ω—Ç–µ–∫—Å—Ç —á–∞—Ç–∞ –∞–Ω–æ–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è (—É–¥–∞–ª—è–µ–º –Ω–∏–∫–∏/–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã, –≥–µ–æ, —è–≤–Ω—ã–µ PII) –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ LLM.
  - –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç **—Ç–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é** –∫–∞–∫ —Å–∫—Ä—ã—Ç—ã–µ inline‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º —Ä–µ—à–∞–µ—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å –∏—Ö –∏–ª–∏ –Ω–µ—Ç.
  - –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (prompt‚Äëguardrails) –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ–º.
- **–ß—Ç–æ –Ω–µ –¥–µ–ª–∞–µ—Ç:**
  - –ù–µ –≤—ã—Å—Ç—É–ø–∞–µ—Ç ¬´—Ç–µ—Ä–∞–ø–µ–≤—Ç–æ–º¬ª, –Ω–µ –¥–∞—ë—Ç –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö/–ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –¥–∏–∞–≥–Ω–æ–∑–æ–≤ –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤.

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å
- –ú–∏–Ω–∏–º—É–º PII: –Ω–µ —Å–æ–±–∏—Ä–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω/–ø–æ—á—Ç—É; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ —è–≤–Ω–æ–º—É —Å–æ–≥–ª–∞—Å–∏—é.
- –ñ–∞–ª–æ–±—ã/–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –∞–≤—Ç–æ‚Äë–º—å—é—Ç –ø—Ä–∏ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤.
- –•—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Telegram; —É –Ω–∞—Å ‚Äî —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –∞–≥—Ä–µ–≥–∞—Ç—ã.
- LLM‚Äë–∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ —Å–ª–æ–π –∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏–∏ + —Ñ–∏–ª—å—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å, —Å–∞–º–æ–ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ, —Å–µ–∫—Å—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç, –Ω–µ–∑–∞–∫–æ–Ω–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å).
- –ú–∏–Ω–∏–º—É–º PII: –Ω–µ —Å–æ–±–∏—Ä–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω/–ø–æ—á—Ç—É; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ —è–≤–Ω–æ–º—É —Å–æ–≥–ª–∞—Å–∏—é.
- –ñ–∞–ª–æ–±—ã/–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –∞–≤—Ç–æ‚Äë–º—å—é—Ç –ø—Ä–∏ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤.
- –•—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Telegram; —É –Ω–∞—Å ‚Äî —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –∞–≥—Ä–µ–≥–∞—Ç—ã.



## Implementation

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ —Ç–µ–∫—É—â–∏–µ –≤–µ—Ä—Å–∏–∏)
- **–Ø–∑—ã–∫/–§—Ä–µ–π–º–≤–æ—Ä–∫**: **Python 3.12**.
- **–ë–æ—Ç**: **aiogram 3.x** (–ø–æ–ª–Ω–æ—Å—Ç—å—é async, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Bot API 9.x), –≤–µ–±—Ö—É–∫–∏. 
- **–í–µ–±‚Äë—Ñ—Ä–µ–π–º–≤–æ—Ä–∫**: **FastAPI** (ASGI), –≤ –ø—Ä–æ–¥–µ ‚Äî **Gunicorn + Uvicorn workers**.
- **ORM**: **SQLAlchemy 2.x** + Alembic (–∏–ª–∏ Prisma Python –Ω–µ—Ç ‚Üí –æ—Å—Ç–∞—ë–º—Å—è –Ω–∞ SQLAlchemy).
- **–ë–î**: **PostgreSQL 18** (JSONB, GIN –∏–Ω–¥–µ–∫—Å—ã).
- **–ö—ç—à/–æ—á–µ—Ä–µ–¥—å**: **Redis 7.4** (Streams –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ –º–∞—Ç—á–µ–π, rate limiting, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ª–æ–∫–∏).
- **–ü–ª–∞—Ç–µ–∂–∏**: **Telegram Stars (XTR) –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —á–∞–µ–≤—ã—Ö** —á–µ—Ä–µ–∑ Bot API; –¥–ª—è EN‚Äë–∑–∞–ø—É—Å–∫–∞ –ø–æ–∑–∂–µ ‚Äî Stripe (–∫–æ–≥–¥–∞ –≤—ã–π–¥–µ–º –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å—Ç—Ä–∞–Ω—ã); –ª–æ–∫–∞–ª—å–Ω—ã–µ PSP ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤–Ω–µ Telegram.
- **AI‚Äëcoach**: —Å–µ—Ä–≤–∏—Å‚Äë–æ–±—ë—Ä—Ç–∫–∞ (FastAPI) ‚Üí LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä, —Å –∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏–µ–π –∏ safety‚Äë—Ñ–∏–ª—å—Ç—Ä–∞–º–∏.
- **DevOps**: Docker; –ø—Ä–æ–¥ ‚Äî Kubernetes/Helm; –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus + Grafana), —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ (Loki/ELK), Sentry.

### –°–µ—Ä–≤–∏—Å–Ω–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞
- `api-gateway` (NestJS, REST + Telegram webhook).
- `match-worker` (NestJS microservice/cron): –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –º–∞—Ç—á–µ–π, —Å–∫–æ—Ä–∏–Ω–≥, TTL.
- `payments-service`: –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–æ–π—Å–æ–≤ Stars, —É—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–π, –≤–µ–±—Ö—É–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤.
- `ai-coach-service`: –∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞, –∑–∞–ø—Ä–æ—Å –∫ LLM, –ø–æ—Å—Ç‚Äë—Ñ–∏–ª—å—Ç—Ä—ã, –º–µ—Ç—Ä–∏–∫–∏.

### –ö–ª—é—á–µ–≤—ã–µ —ç–Ω–¥–ø–æ–π–Ω—Ç—ã (—á–µ—Ä–Ω–æ–≤–∏–∫)
- `POST /telegram/webhook` ‚Äî –∞–ø–¥–µ–π—Ç—ã.
- `POST /match/find` ‚Äî –ø–æ—Å—Ç–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å.
- `POST /match/confirm` ‚Äî –≤–∑–∞–∏–º–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ.
- `POST /tips/create` ‚Äî –≤—ã—Å—Ç–∞–≤–∏—Ç—å —Å—á—ë—Ç (Stars XTR).
- `POST /ai/hint` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É (—Å–∫—Ä—ã—Ç–æ, —Ç–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é).

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å—Ö–µ–º—ã (SQLAlchemy + Alembic, —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã)
```python
from sqlalchemy import BigInteger, String, Boolean, DateTime, ForeignKey, Integer
from sqlalchemy.orm import DeclarativeBase, Mapped, mapped_column
from datetime import datetime

class Base(DeclarativeBase):
    pass

class User(Base):
    __tablename__ = 'users'
    id: Mapped[int] = mapped_column(BigInteger, primary_key=True, autoincrement=True)
    tg_id: Mapped[int] = mapped_column(BigInteger, unique=True)
    nickname: Mapped[str] = mapped_column(String(64))
    tz: Mapped[str] = mapped_column(String(32))
    bio_short: Mapped[str | None] = mapped_column(String(160))
    safety_ack: Mapped[bool] = mapped_column(Boolean, default=False)
    created_at: Mapped[datetime] = mapped_column(DateTime, default=datetime.utcnow)
```prisma
model User {
  id           BigInt   @id @default(autoincrement())
  tgId         BigInt   @unique
  nickname     String   @db.VarChar(64)
  tz           String   @db.VarChar(32)
  bioShort     String?  @db.VarChar(160)
  safetyAck    Boolean  @default(false)
  createdAt    DateTime @default(now())
  topics       UserTopic[]
}

model Topic {
  id     Int     @id @default(autoincrement())
  slug   String  @unique
  title  String
  users  UserTopic[]
}

model UserTopic {
  userId  BigInt
  topicId Int
  weight  Int     @default(1)
  @@id([userId, topicId])
  @@index([topicId])
}

model Match {
  id        BigInt   @id @default(autoincrement())
  userA     BigInt
  userB     BigInt
  status    String   @db.VarChar(16) // proposed, active, declined, expired
  createdAt DateTime @default(now())
  @@unique([userA, userB])
}

model ChatSession {
  id        BigInt   @id @default(autoincrement())
  matchId   BigInt   @unique
  startedAt DateTime @default(now())
  endedAt   DateTime?
  ratingA   Int?
  ratingB   Int?
}

model Tip {
  id          BigInt   @id @default(autoincrement())
  matchId     BigInt
  fromUser    BigInt
  toUser      BigInt
  amountMinor BigInt
  currency    String   @db.VarChar(8) // XTR
  provider    String   @db.VarChar(32) // telegram-stars
  providerFee BigInt   @default(0)
  ourFee      BigInt   @default(0)
  status      String   @db.VarChar(16) // pending, paid, failed
  createdAt   DateTime @default(now())
  @@index([matchId])
}

model AiHint {
  id        BigInt   @id @default(autoincrement())
  chatId    BigInt
  userId    BigInt
  hintType  String   @db.VarChar(16) // empathy, question, boundary
  text      String
  accepted  Boolean  @default(false)
  createdAt DateTime @default(now())
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º—ã (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è)
- **–û—á–µ—Ä–µ–¥—å –º–∞—Ç—á–µ–π (Redis Streams):**
  - Producer: `match/find` –ø–∏—à–µ—Ç —Å–æ–±—ã—Ç–∏–µ `user_id, topics[], tz`.
  - Consumer group `match-workers` —á–∏—Ç–∞–µ—Ç, –∏—â–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ SQL:
    - `JOIN user_topics` –ø–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é ‚â•2 —Ç–µ–º; —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Å—É–º–º–µ –≤–µ—Å–æ–≤.
    - –§–∏–ª—å—Ç—Ä –ø–æ —á–∞—Å–æ–≤–æ–º—É –ø–æ—è—Å—É/–æ–∫–Ω–∞–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.
  - –ê–Ω—Ç–∏‚Äë–ø–æ–≤—Ç–æ—Ä—ã: —Ç–∞–±–ª–∏—Ü–∞ `recent_contacts(user_id, other_id, until)`.
- **–°–∫–æ—Ä–∏–Ω–≥:** `0.6 * tag_overlap + 0.2 * time_overlap + 0.2 * helpfulness_score`.
- **AI‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∏:**
  - –ü—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä: —É–¥–∞–ª–µ–Ω–∏–µ PII, –∑–∞–º–µ–Ω–∞ –Ω–∏–∫–Ω–µ–π–º–æ–≤ —Ç–æ–∫–µ–Ω–∞–º–∏, —É—Å–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
  - Prompt‚Äë—à–∞–±–ª–æ–Ω—ã –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ–º (—É—Ç—Ä–∞—Ç–∞ –ø–∏—Ç–æ–º—Ü–∞, —Ä–∞–∑–≤–æ–¥, –≤—ã–≥–æ—Ä–∞–Ω–∏–µ) + —Å—Ç–∏–ª—å ¬´—ç–º–ø–∞—Ç–∏—è, –≤–∞–ª–∏–¥–∏—Ä—É—é—â–∏–µ —Ñ—Ä–∞–∑—ã, –±–µ–∑ –¥–∏–∞–≥–Ω–æ–∑–æ–≤¬ª.
  - –†–µ–Ω–¥–µ—Ä –≤ inline‚Äë–∫–Ω–æ–ø–∫–µ ¬´–í—Å—Ç–∞–≤–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É¬ª.

### –ü–ª–∞—Ç–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫ (Stars, XTR)
1) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç ¬´–û—Å—Ç–∞–≤–∏—Ç—å —á–∞–µ–≤—ã–µ¬ª.  
2) –ë–æ—Ç —Å–æ–∑–¥–∞—ë—Ç –∏–Ω–≤–æ–π—Å XTR, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—É–º–º—É —Å –Ω–∞—à–µ–π –∫–æ–º–∏—Å—Å–∏–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10%).  
3) Telegram –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–ø–ª–∞—Ç—É; –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∏ –ø–∏—à–µ—Ç –∑–∞–ø–∏—Å—å `Tip`.  
4) –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å ‚Äî –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º Telegram Stars.

### –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
- Onboarding‚Äë–∫–∞—Ä—Ç–æ—á–∫–∏ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ (–Ω–µ –¥–∞–≤–∞—Ç—å –¥–∏–∞–≥–Ω–æ–∑—ã, –Ω–µ –æ–±–µ—â–∞—Ç—å ¬´–ø–æ—á–∏–Ω–∏—Ç—å¬ª, —É–≤–∞–∂–∞—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã, SOS‚Äë—Ä–µ—Å—É—Ä—Å—ã).
- –ö–Ω–æ–ø–∫–∞ ¬´SOS¬ª —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –≥–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏ –ø–æ —Å—Ç—Ä–∞–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –§–∏–ª—å—Ç—Ä —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ ‚Äî soft‚Äëblock + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—É.

### QA –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –ú–µ—Ç—Ä–∏–∫–∏: `match_rate`, `accept_rate`, `chat_duration`, `tip_rate`, `avg_tip`, `report_rate`.
- A/B‚Äë—Ñ–ª–∞–≥–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `experiment_assignments`.
- –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –º–∞—Ç—á‚Äë–ø–æ–∏—Å–∫–∞ (pgbench + k6).

## Milestones
1. **M0 ‚Äî –°–∫–µ–ª–µ—Ç –±–æ—Ç–∞ (1‚Äì2 –Ω–µ–¥–µ–ª–∏):** /start, –∞–Ω–∫–µ—Ç–∞, —Ç–µ–º—ã, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (aiogram + FastAPI, webhook, DB –º–∏–≥—Ä–∞—Ü–∏–∏).
2. **M1 ‚Äî –ú–∞—Ç—á–∏–Ω–≥ 1‚Äë–Ω–∞‚Äë1 (1‚Äì2 –Ω–µ–¥–µ–ª–∏):** –æ—á–µ—Ä–µ–¥—å (Redis Streams), —Å–∫–æ—Ä–∏–Ω–≥, –≤–∑–∞–∏–º–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ, —Å—Ç–∞—Ä—Ç –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —á–∞—Ç–∞.
3. **M2 ‚Äî –ß–∞–µ–≤—ã–µ (1 –Ω–µ–¥–µ–ª—è):** –∏–Ω–≤–æ–π—Å—ã Stars (XTR) —á–µ—Ä–µ–∑ Bot API, –∑–∞–ø–∏—Å—å –∫–æ–º–∏—Å—Å–∏–π, —á–µ–∫ –≤ —á–∞—Ç–µ.
4. **M3 ‚Äî AI‚Äëcoach (2 –Ω–µ–¥–µ–ª–∏):** –∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è, –±–∞–∑–æ–≤—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ RU, —Ä—É—á–Ω–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è.
5. **M4 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å (1 –Ω–µ–¥–µ–ª—è):** –∂–∞–ª–æ–±—ã/–±–ª–æ–∫, SOS, –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏, –∞–ª–µ—Ä—Ç—ã.
6. **M5 ‚Äî –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ (1 –Ω–µ–¥–µ–ª—è):** –æ–Ω–±–æ—Ä–¥–∏–Ω–≥, —Ç–µ–∫—Å—Ç—ã, –ª–∏–º–∏—Ç—ã, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.

## Gathering Results
- **–¶–µ–ª–∏ MVP (—á–µ—Ä–µ–∑ 4 –Ω–µ–¥–µ–ª–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞):**
  - ‚â•60% –ø–æ–ª—É—á–∞—é—Ç –º–∞—Ç—á ‚â§24—á; `accept_rate` ‚â•40%; —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚â•10 –º–∏–Ω.
  - `tip_rate` ‚â•8%, `avg_tip` ‚â• –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –ø–æ—Ä–æ–≥–∞; –∂–∞–ª–æ–±—ã ‚â§3%.
- **–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å:** 10‚Äì15 –∏–Ω—Ç–µ—Ä–≤—å—é; –ø—Ä–∞–≤–∫–∏ —Å–∫–æ—Ä–∏–Ω–≥–∞/–æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞/–ø–æ–¥—Å–∫–∞–∑–æ–∫ AI.

## ToR (–¢–µ—Ö–∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–≤)
**–¶–µ–ª—å:** —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å MVP Telegram‚Äë–±–æ—Ç–∞ ¬´–¢—ã –Ω–µ –æ–¥–∏–Ω¬ª —Å –º–∞—Ç—á–∏–Ω–≥–æ–º 1‚Äë–Ω–∞‚Äë1, –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å—é, —á–∞–µ–≤—ã–º–∏ (Stars) –∏ AI‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ RU.

**–ü–∏–ª–æ—Ç–Ω—ã–µ –¥–æ–ø—É—â–µ–Ω–∏—è:**
- –ê—É–¥–∏—Ç–æ—Ä–∏—è: **100‚Äì300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –≤ –ø–µ—Ä–≤—ã–π –º–µ—Å—è—Ü.
- –†–∞–∑–º–µ—â–µ–Ω–∏–µ: **EU‚Äë—Ä–µ–≥–∏–æ–Ω** –¥–ª—è –Ω–∞–∏–ª—É—á—à–µ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ RU/CIS.
- –ë—é–¥–∂–µ—Ç: **free/–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç–∏—Ä—ã**; –¥–æ–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ—Å–ø—è—á–∫—É.

**–û–±—ä—ë–º —Ä–∞–±–æ—Ç (—Å–ø—Ä–∏–Ω—Ç—ã):**
- **–°–ø—Ä–∏–Ω—Ç 1 (M0):** –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (—Ä–µ–ø–æ, CI, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã), FastAPI + aiogram, /start, –∞–Ω–∫–µ—Ç–∞, –ø—Ä–æ—Ñ–∏–ª—å, –ë–î, –≤–µ–±—Ö—É–∫, –∫–æ–º–∞–Ω–¥—ã.
- **–°–ø—Ä–∏–Ω—Ç 2 (M1):** Redis Streams, –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–±–æ—Ä–∞ (SQL + –∏–Ω–¥–µ–∫—Å—ã), –≤–∑–∞–∏–º–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ, —Å—Ç–∞—Ä—Ç –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —á–∞—Ç–∞, –ª–æ–≥–∏/–º–µ—Ç—Ä–∏–∫–∏.
- **–°–ø—Ä–∏–Ω—Ç 3 (M2):** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Stars: –∏–Ω–≤–æ–π—Å XTR, —Å—Ç–∞—Ç—É—Å—ã, –∑–∞–ø–∏—Å—å –∫–æ–º–∏—Å—Å–∏–π, –∫–≤–∏—Ç–∞–Ω—Ü–∏—è –≤ —á–∞—Ç–µ, –∞–¥–º–∏–Ω‚Äë–æ—Ç—á—ë—Ç—ã.
- **–°–ø—Ä–∏–Ω—Ç 4 (M3):** AI‚Äëcoach —Å–µ—Ä–≤–∏—Å, –∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è, –ø—Ä–æ–º–ø—Ç‚Äë—à–∞–±–ª–æ–Ω—ã RU, safety‚Äë—Ñ–∏–ª—å—Ç—Ä—ã, inline‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∏, —Ñ–ª–∞–≥–∏ –≤–∫–ª—é—á–µ–Ω–∏—è.
- **–°–ø—Ä–∏–Ω—Ç 5 (M4‚ÄìM5):** –∂–∞–ª–æ–±—ã/–±–ª–æ–∫, SOS, –∞–Ω—Ç–∏‚Äë—Å–ø–∞–º/—Ä–µ–π—Ç‚Äë–ª–∏–º–∏—Ç—ã, –∞–ª–µ—Ä—Ç—ã, A/B —Ñ–ª–∞–≥–∏, —Ç–µ–∫—Å—Ç—ã.

**–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã:**
- –¢–ó –Ω–∞ –ë–î (ER‚Äë–¥–∏–∞–≥—Ä–∞–º–º–∞, –º–∏–≥—Ä–∞—Ü–∏–∏), API‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã (OpenAPI), —á–µ–∫‚Äë–ª–∏—Å—Ç—ã —Ç–µ—Å—Ç–æ–≤, Helm‚Äë—á–∞—Ä—Ç—ã, runbook.

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- 95% –∞–ø–¥–µ–π—Ç–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è <500 –º—Å –ø—Ä–∏ 100 RPS (—Å—Ç–µ–Ω–¥).
- –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ XTR end‚Äëto‚Äëend; –∑–∞–ø–∏—Å—å –∫–æ–º–∏—Å—Å–∏–π; –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—Ç–º–µ–Ω–∞/–æ—à–∏–±–∫–∏.
- –ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å: –≤ –ª–æ–≥–∞—Ö –Ω–µ—Ç PII; —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è –±–µ–∑ tg_id –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ.
- AI‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∏: RU‚Äë—Ç–µ–∫—Å—Ç—ã, –Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏; –≤–∫–ª—é—á–∞—é—Ç—Å—è —Ñ–ª–∞–≥–æ–º.

**–ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:**
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ª–∏–Ω—Ç–µ—Ä—ã/—Ç–∞–π–ø—ã: ruff, mypy, black; –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ ‚â•70% –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—É—Ç–∏.
- –°–µ–∫—Ä–µ—Ç—ã –≤ Vault/Secrets Manager; TLS 1.3; HSTS –Ω–∞ webhook.

**–†–∏—Å–∫–∏/–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:** –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ Telegram –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤/Stars, —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–æ –¥–æ–Ω–∞—Ç–∞–º.

## Technical Review ‚Äî Best Practices
- **Bot API & –ø–ª–∞—Ç–µ–∂–∏:** –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —É—Å–ª—É–≥ Telegram —Ç—Ä–µ–±—É–µ—Ç **Stars (XTR)**; –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥—ã Bot API 9.x (`XTR` –≤–∞–ª—é—Ç–∞). ÓàÄciteÓàÇturn0search2ÓàÇturn0search8ÓàÅ
- **Telegram‚Äë—Ñ—Ä–µ–π–º–≤–æ—Ä–∫:** **aiogram 3.x** ‚Äî –∞–∫—Ç—É–∞–ª—å–Ω—ã–π async‚Äë—Å—Ç–µ–∫ –¥–ª—è Python. ÓàÄciteÓàÇturn0search1ÓàÇturn0search17ÓàÅ
- **–í–µ–±—Ö—É–∫–∏:** –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏ –∞–ø–¥–µ–π—Ç–æ–≤; HTTPS, –≤–∞–ª–∏–¥–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç; —Å–º. —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ Telegram. ÓàÄciteÓàÇturn1search0ÓàÅ
- **ASGI‚Äë–¥–µ–ø–ª–æ–π:** Gunicorn —Å uvicorn‚Äëworker ‚Äî –∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è FastAPI. ÓàÄciteÓàÇturn1search13ÓàÅ
- **–•—Ä–∞–Ω–∏–ª–∏—â–∞:** PostgreSQL 18 (—Å–≤–µ–∂–∏–π —Ä–µ–ª–∏–∑) –∏ Redis 7.4 (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤—ã—Ö —Ñ–∏—á, TLS). ÓàÄciteÓàÇturn0search6ÓàÇturn0search15ÓàÅ
- **Stripe:** –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –†–§; –ø–ª–∞–Ω–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –¥–ª—è EN‚Äë—Ä—ã–Ω–∫–æ–≤. ÓàÄciteÓàÇturn0search11ÓàÅ
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å Telegram‚Äë–±–æ—Ç–æ–≤:** –±–æ—Ç‚Äë—á–∞—Ç—ã –Ω–µ E2E‚Äë—à–∏—Ñ—Ä—É—é—Ç—Å—è (HTTPS/TLS), –ø–æ—ç—Ç–æ–º—É –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. ÓàÄciteÓàÇturn1news20ÓàÅ

## –ë—é–¥–∂–µ—Ç: –∑–∞–ø—É—Å–∫ –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö/–º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —Ç–∏—Ä–∞—Ö (Test Phase)
**–¶–µ–ª—å:** —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å MVP —Å –º–∏–Ω–∏–º—É–º–æ–º –∑–∞—Ç—Ä–∞—Ç, –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ‚Äë–∑–∞—Å—ã–ø–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤.

### –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Å—Ö–µ–º–∞ (EU)
- **–•–æ—Å—Ç–∏–Ω–≥ API/–±–æ—Ç–∞**: Render/Fly.io/Railway ‚Äî –≤—ã–±—Ä–∞—Ç—å **EU‚Äë–ª–æ–∫–∞—Ü–∏—é** (–Ω–∞–ø—Ä–∏–º–µ—Ä, Frankfurt/AMS); –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ‚Äë—Å–ø—è—á–∫—É.
- **PostgreSQL**: Neon/Supabase ‚Äî –∫–ª–∞—Å—Ç–µ—Ä –≤ **EU‚ÄëWest**; –ø–æ–¥–∫–ª—é—á–∏—Ç—å pgBouncer/Pooling.
- **Redis/–û—á–µ—Ä–µ–¥—å**: Upstash/Redis Cloud ‚Äî EU‚Äë—Ä–µ–≥–∏–æ–Ω, –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω.
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥/–ª–æ–≥–∏**: Grafana Cloud (EU) free + Sentry EU; –±–∞–∑–æ–≤—ã–µ –∞–ª–µ—Ä—Ç—ã –ø–æ –≤–µ–±—Ö—É–∫—É.
- **–û–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**: Cloudflare R2 ‚Äî EU; –±—ç–∫–∞–ø—ã –ë–î/—Å–Ω–∞–ø—à–æ—Ç—ã —Å—Ö–µ–º.
- **CI/CD**: GitHub Actions ‚Äî free‚Äëminutes, –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º.
- **–ü–ª–∞—Ç–µ–∂–∏**: Telegram Stars ‚Äî –±–µ–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –ø–ª–∞—Ç—ë–∂–Ω–æ–π –∏–Ω—Ñ—Ä—ã.

### –û–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª–∏ –∑–∞—Ç—Ä–∞—Ç
- –§–∏—á–∞‚Äë—Ñ–ª–∞–≥–∏: AI‚Äëcoach –≤—ã–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –≤–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ 5‚Äì10% —á–∞—Ç–æ–≤.
- Aggressive idle‚Äëtimeouts: gunicorn `--timeout 30`, –±–∞–∑—ã —Å auto‚Äësuspend.
- Rate limiting: cap RPS –¥–æ 2‚Äì5 RPS –Ω–∞ IP/user.
- –ö—Ä–æ–Ω‚Äë–∑–∞–¥–∞—á–∏ —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏; –ª–æ–≥–∏ ‚Äî 7 –¥–Ω–µ–π retention.

### SLA –ø–∏–ª–æ—Ç–∞ –∏ –∞–ø–≥—Ä–µ–π–¥
- –¶–µ–ª—å –ø–∏–Ω–≥–∞: p95 < 1.5s –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Ç–∏—Ä–∞—Ö.
- –ü–æ—Ä–æ–≥ –∞–ø–≥—Ä–µ–π–¥–∞: >300 MAU –∏–ª–∏ –æ—á–µ—Ä–µ–¥–∏ > 50 —Å–æ–±—ã—Ç–∏–π/–º–∏–Ω ‚Üí –ø–µ—Ä–µ–Ω–æ—Å API/–±–æ—Ç–∞ –Ω–∞ –æ–¥–∏–Ω VPS –≤ EU (Hetzner/DigitalOcean) —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ü–µ–Ω–æ–π.

## Need Professional Help in Developing Your Architecture?
–ü–∏—à–∏—Ç–µ: [sammuti.com](https://sammuti.com) üôÇ
–ü–∏—à–∏—Ç–µ: [sammuti.com](https://sammuti.com) üôÇ in Developing Your Architecture?
–ü–∏—à–∏—Ç–µ: [sammuti.com](https://sammuti.com) üôÇ



---

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –ß–µ–∫‚Äë–ª–∏—Å—Ç –∑–∞–ø—É—Å–∫–∞, —Å–∫–µ–ª–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –ø–ª–∞–Ω –°–ø—Ä–∏–Ω—Ç–∞¬†1

## –ß–µ–∫‚Äë–ª–∏—Å—Ç –∑–∞–ø—É—Å–∫–∞ Telegram‚Äë–±–æ—Ç–∞
1. **BotFather**
   - [ ] `/newbot`: –∏–º—è –∏ `@username`.
   - [ ] `/setdescription`, `/setabouttext`, `/setuserpic`.
   - [ ] `/setprivacy` ‚Üí Disable (—á—Ç–æ–±—ã –±–æ—Ç –≤–∏–¥–µ–ª –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–∏—á–Ω—ã—Ö —á–∞—Ç–∞—Ö —Å –Ω–∏–º).
   - [ ] `/setcommands` (RU):
     ```
     start - –Ω–∞—á–∞—Ç—å
     profile - –ø—Ä–æ—Ñ–∏–ª—å
     find - –Ω–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
     tips - –æ—Å—Ç–∞–≤–∏—Ç—å —á–∞–µ–≤—ã–µ
     help - –ø—Ä–∞–≤–∏–ª–∞ –∏ –ø–æ–º–æ—â—å
     ```
   - [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å **Stars (XTR)**: –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø–ª–∞—Ç–µ–∂–µ–π (BotFather ‚Üí Payments/Stars), —É–∫–∞–∑–∞—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª—è.
2. **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
   - [ ] –î–æ–º–µ–Ω `api.<project>.ru`, TLS‚Äë—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt/ACM).
   - [ ] Webhook URL: `https://api.<project>.ru/telegram/webhook`.
   - [ ] –°–µ–∫—Ä–µ—Ç—ã –≤ Vault/Secrets Manager: `TELEGRAM_BOT_TOKEN`, `DATABASE_URL`, `REDIS_URL`, `STARS_*`.
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - [ ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ IP/Geo –Ω–∞ webhook (CDN/Firewall), HSTS.
   - [ ] Rate limit –Ω–∞ user_id/chat_id (Redis Leaky Bucket).
   - [ ] –õ–æ–≥–∏ –±–µ–∑ PII; trace‚Äëids; –∞–ª–µ—Ä—Ç—ã p95 latency, error rate.
4. **–ü–ª–∞—Ç–µ–∂–∏**
   - [ ] –¢–µ—Å—Ç –∏–Ω–≤–æ–π—Å–∞ XTR –≤ —Å—ç–Ω–¥–±–æ–∫—Å–µ/–Ω–∏–∑–∫–∏—Ö —Å—É–º–º–∞—Ö.
   - [ ] –£—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ –∏ —á–µ–∫‚Äë—Å–æ–æ–±—â–µ–Ω–∏–µ.
5. **–ö–æ–Ω—Ç–µ–Ω—Ç**
   - [ ] Onboarding‚Äë–∫–∞—Ä—Ç–æ—á–∫–∏ (–ø—Ä–∞–≤–∏–ª–∞/–¥–∏—Å–∫–ª–µ–π–º–µ—Ä—ã, SOS‚Äë—Å—Å—ã–ª–∫–∏ –ø–æ —Å—Ç—Ä–∞–Ω–µ RU/CIS).
   - [ ] –®–∞–±–ª–æ–Ω—ã –ø–æ–¥—Å–∫–∞–∑–æ–∫ AI (RU) ‚Äî —Ñ–∏—á–∞‚Äë—Ñ–ª–∞–≥ `ai_hints=true`.

## –°–∫–µ–ª–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (Python, FastAPI + aiogram)
```
repo
‚îú‚îÄ apps
‚îÇ  ‚îú‚îÄ api
‚îÇ  ‚îÇ  ‚îú‚îÄ main.py
‚îÇ  ‚îÇ  ‚îú‚îÄ deps.py
‚îÇ  ‚îÇ  ‚îú‚îÄ routers
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ health.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ payments.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ match.py
‚îÇ  ‚îÇ  ‚îî‚îÄ telemetry.py
‚îÇ  ‚îú‚îÄ bot
‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îú‚îÄ bot.py
‚îÇ  ‚îÇ  ‚îú‚îÄ handlers
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ start.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ profile.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ find.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ tips.py
‚îÇ  ‚îÇ  ‚îú‚îÄ middlewares
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ rate_limit.py
‚îÇ  ‚îÇ  ‚îî‚îÄ keyboards
‚îÇ  ‚îÇ     ‚îú‚îÄ inline.py
‚îÇ  ‚îÇ     ‚îî‚îÄ reply.py
‚îÇ  ‚îú‚îÄ ai_coach
‚îÇ  ‚îÇ  ‚îú‚îÄ main.py
‚îÇ  ‚îÇ  ‚îú‚îÄ anonymize.py
‚îÇ  ‚îÇ  ‚îî‚îÄ provider.py
‚îÇ  ‚îî‚îÄ workers
‚îÇ     ‚îî‚îÄ match_worker.py
‚îú‚îÄ core
‚îÇ  ‚îú‚îÄ config.py
‚îÇ  ‚îú‚îÄ db.py
‚îÇ  ‚îú‚îÄ redis.py
‚îÇ  ‚îî‚îÄ security.py
‚îú‚îÄ migrations (alembic)
‚îú‚îÄ models (SQLAlchemy)
‚îÇ  ‚îú‚îÄ __init__.py
‚îÇ  ‚îú‚îÄ user.py
‚îÇ  ‚îú‚îÄ topic.py
‚îÇ  ‚îú‚îÄ match.py
‚îÇ  ‚îú‚îÄ chat.py
‚îÇ  ‚îú‚îÄ tip.py
‚îÇ  ‚îî‚îÄ ai.py
‚îú‚îÄ tests
‚îÇ  ‚îú‚îÄ unit
‚îÇ  ‚îî‚îÄ integration
‚îú‚îÄ deploy
‚îÇ  ‚îú‚îÄ docker
‚îÇ  ‚îÇ  ‚îú‚îÄ api.Dockerfile
‚îÇ  ‚îÇ  ‚îú‚îÄ bot.Dockerfile
‚îÇ  ‚îÇ  ‚îî‚îÄ worker.Dockerfile
‚îÇ  ‚îú‚îÄ compose.yml
‚îÇ  ‚îî‚îÄ k8s
‚îÇ     ‚îú‚îÄ api.yaml
‚îÇ     ‚îú‚îÄ bot.yaml
‚îÇ     ‚îú‚îÄ worker.yaml
‚îÇ     ‚îî‚îÄ redis-postgres.yaml
‚îú‚îÄ Makefile
‚îú‚îÄ pyproject.toml
‚îú‚îÄ README.md
‚îî‚îÄ .env.example
```

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã (—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã)
**apps/api/main.py**
```python
from fastapi import FastAPI
from apps.api.routers import health

app = FastAPI(title="ty-ne-odin API")
app.include_router(health.router)

@app.get("/")
def root():
    return {"status": "ok"}
```

**apps/bot/bot.py**
```python
import asyncio
from aiogram import Bot, Dispatcher
from aiogram.webhook.aiohttp_server import SimpleRequestHandler, setup_application
from aiohttp import web
import os

BOT_TOKEN = os.environ["TELEGRAM_BOT_TOKEN"]
WEBHOOK_PATH = "/telegram/webhook"

bot = Bot(BOT_TOKEN)
dp = Dispatcher()

async def on_startup(app: web.Application):
    await bot.set_webhook(app["base_url"] + WEBHOOK_PATH)

def create_app(base_url: str):
    app = web.Application()
    app["base_url"] = base_url
    SimpleRequestHandler(dispatcher=dp, bot=bot).register(app, path=WEBHOOK_PATH)
    app.on_startup.append(on_startup)
    setup_application(app, dp, bot=bot)
    return app

if __name__ == "__main__":
    web.run_app(create_app(os.getenv("PUBLIC_BASE_URL")))
```

**deploy/compose.yml**
```yaml
services:
  api:
    build: { context: .., dockerfile: deploy/docker/api.Dockerfile }
    env_file: ../.env
    ports: ["8000:8000"]
    depends_on: [db, redis]
  bot:
    build: { context: .., dockerfile: deploy/docker/bot.Dockerfile }
    env_file: ../.env
    environment:
      PUBLIC_BASE_URL: ${PUBLIC_BASE_URL}
    ports: ["8080:8080"]
    depends_on: [api]
  worker:
    build: { context: .., dockerfile: deploy/docker/worker.Dockerfile }
    env_file: ../.env
    depends_on: [db, redis]
  db:
    image: postgres:18
    environment:
      POSTGRES_PASSWORD: postgres
    ports: ["5432:5432"]
  redis:
    image: redis:7.4
    ports: ["6379:6379"]
```

**Makefile**
```makefile
.PHONY: up down fmt lint test migrate
up: ; docker compose -f deploy/compose.yml up -d --build
down: ; docker compose -f deploy/compose.yml down -v
fmt: ; ruff check --fix . && black . && isort .
lint: ; mypy . && ruff check .
test: ; pytest -q
migrate: ; alembic upgrade head
```

**.env.example**
```
TELEGRAM_BOT_TOKEN=xxx
DATABASE_URL=postgresql+psycopg://postgres:postgres@db:5432/postgres
REDIS_URL=redis://redis:6379/0
PUBLIC_BASE_URL=https://api.example.ru
```

## –ü–ª–∞–Ω –°–ø—Ä–∏–Ω—Ç–∞¬†1 (2 –Ω–µ–¥–µ–ª–∏)
**–¶–µ–ª—å:** –ø–æ–¥–Ω—è—Ç—å —Å–∫–µ–ª–µ—Ç —Å–µ—Ä–≤–∏—Å–∞ –∏ –±–∞–∑–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: /start, –ø—Ä–æ—Ñ–∏–ª—å, –∞–Ω–∫–µ—Ç–∞, –∑–∞–ø–∏—Å–∏ –≤ –ë–î, webhook, health.

**–ó–∞–¥–∞—á–∏ (issues):**
- FEAT‚Äë1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, pyproject, –±–∞–∑–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (FastAPI, aiogram, SQLAlchemy, Alembic, Redis, pydantic, loguru, ruff, mypy, pytest).
- FEAT‚Äë2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Docker –∏ compose (api, bot, worker, db, redis).
- FEAT‚Äë3: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é /setwebhook.
- FEAT‚Äë4: –ú–æ–¥–µ–ª—å –ë–î: users, topics, user_topics + –º–∏–≥—Ä–∞—Ü–∏–∏.
- FEAT‚Äë5: –•—ç–Ω–¥–ª–µ—Ä—ã –±–æ—Ç–∞: /start, /profile, —Å–±–æ—Ä —Ç–µ–º (inline‚Äë–∫–Ω–æ–ø–∫–∏), —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î.
- FEAT‚Äë6: Health/metrics —ç–Ω–¥–ø–æ–π–Ω—Ç—ã, Prometheus —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä.
- CHORE‚Äë1: –õ–∏–Ω—Ç–µ—Ä—ã/—Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä—ã (ruff/black/isort, mypy), pre‚Äëcommit.
- OPS‚Äë1: CI (GitHub Actions): –ª–∏–Ω—Ç/—Ç–µ—Å—Ç/–±–∏–ª–¥ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- Webhook —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ HTTPS, –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ /start –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å.
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –º–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ.
- –ö–æ–¥ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ª–∏–Ω—Ç–µ—Ä—ã –∏ —Ç–µ—Å—Ç—ã; –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è.

**–†–∏—Å–∫–∏ –∏ –ø–ª–∞–Ω B:**
- –ü—Ä–æ–±–ª–µ–º—ã —Å TLS/–¥–æ–º–µ–Ω–æ–º ‚Üí –≤—Ä–µ–º–µ–Ω–Ω—ã–π ngrok/Cloudflare Tunnel (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–µ–π–¥–∂–∞).
- Telegram –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ webhook —á–∞—Å—Ç–æ—Ç—É ‚Üí –±—ç–∫–æ—Ñ—Ñ –∏ –∞–ª–µ—Ä—Ç—ã.

